{% load cache %}
<!DOCTYPE html>
<html>
  <head>
    <title>Inbox</title>
  </head>
  <body>
    <h1>Your Inbox</h1>

    <h2>Received Messages</h2>
    {% if received_messages %}
    <ul>
      {% for message in received_messages %}
      <li>
        <strong>From {{ message.sender.username }}:</strong>
        {{ message.content }}
        <em>({{ message.timestamp }})</em>

        <span>
          {% if not message.read %}
          <strong>NEW</strong>
          {% endif %}
        </span>

        <span>
          {% if message.edited %}
          <strong>EDITED</strong>
          {% endif %}
        </span>

        <br />

        <small>
          <a href="{% url 'message_history' message.id %}">View History</a> |
          <a href="{% url 'threaded_conversation' message.id %}">View Thread</a>
        </small>
      </li>
      {% endfor %}
    </ul>
    {% else %}
    <p>No messages received.</p>
    {% endif %}

    <h2>Sent Messages</h2>
    {% if sent_messages %}
    <ul>
      {% for message in sent_messages %}
      <li>
        <strong>To {{ message.receiver.username }}:</strong>
        {{ message.content }}
        <em>({{ message.timestamp }})</em>

        {% if message.edited %}
        <strong>EDITED</strong>
        {% endif %}

        <br />
        <small>
          <a href="{% url 'edit_message' message.id %}">Edit</a> |
          <a href="{% url 'message_history' message.id %}">View History</a> |
          <a href="{% url 'threaded_conversation' message.id %}">View Thread</a>
        </small>
      </li>
      {% endfor %}
    </ul>
    {% else %}
    <p>No messages sent.</p>
    {% endif %}

    <h2>Notifications</h2>
    {% if notifications %}
    <ul>
      {% for notification in notifications %}
      <li>
        <strong>{{ notification.notification_type }}:</strong>
        {{ notification.message.content|truncatewords:10 }}
        <em>({{ notification.created_at }})</em>

        {% if not notification.read %}
        <strong>UNREAD</strong>
        {% endif %}
      </li>
      {% endfor %}
    </ul>
    {% else %}
    <p>No notifications.</p>
    {% endif %}

    <br />

    <a href="{% url 'send_message' %}">Send New Message</a> |
    <a href="/admin/">Admin Panel</a> |
    <a href="{% url 'delete_user' %}" style="color: red">Delete Account</a>

    <br /><br />

    <div style="background: #f0f0f0; padding: 10px; margin: 10px 0">
      <strong>Quick Links:</strong><br />

      <a href="{% url 'unread_inbox' %}">
        Unread Messages ({{ unread_count }})
      </a>

      | <a href="{% url 'inbox_summary' %}">Inbox Summary</a> |
      <a href="{% url 'send_message' %}">Send New Message</a>
    </div>
  </body>
</html>
